image: ubuntu:bionic

stages:
  - build
  - test
  - packages

build:
  stage: build
  before_script:
    - apt update
    - apt -y install make gcc build-essential libknot-dev libtrace3-dev
  script:
    - make all
  artifacts:
    paths:
      - dns-collector

# test:
#   stage: test
#   before_script:
#     - apt update
#     - apt -y install make
#   script:
#     - make test

package_ubuntu1804:
  stage: packages
  image: helb/fwd-ubuntu-bionic
  before_script:
    - apt update
    - apt -y install make gcc build-essential libknot-dev libtrace3-dev
  script:
    - make all
    - fpm -s dir -t deb -n dns-collector -v 1.0 --prefix /usr/bin dns-collector
  artifacts:
    paths:
      - dns-collector-1.0.amd64.deb
